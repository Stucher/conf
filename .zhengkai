export TERM=linux
export TERM=xterm-256color

export EDITOR=vim
#export PAGER=vimpager

HOST="\h";
if [[ -n $SSH_CONNECTION ]];
then
	HOST="\[\033[38;5;217m\]\h\[\033[00m\]";
fi

export CCACHE_DIR=/tmp/ccache

settitle() {
	printf "\033]2;$1\033\\"
}

ssh() {
	settitle "SSH $*"
	command ssh "$@"
}

parse_git_dirty() {
	i=`(git status -s | wc -l) 2> /dev/null`
	if [ $i -gt 0 ]; then
		echo " ] [ $i \/ `git diff | wc -l`"
	fi
}

parse_git_branch() {
	git branch --no-color 2> /dev/null | sed -e '/^[^*]/d' -e "s/* \(.*\)/ [ \1$(parse_git_dirty) ]/"
}

PS1_TIME="\n\[\033[1;38;5;112m\]\D{%I:%M:%S %p}\[\033[00m\]"
PS1_HOST="\[\033[38;5;39m\]\u@$HOST"
PS1_PWD="\[\033[1;38;5;39m\]\w\[\033[00m\]"

PS1_GIT="\[\033[38;5;39m\]"'$(parse_git_branch)'"\[\033[00m\]"
PS1_PROMPT="\n \[\033[38;5;208m\]Â»\[\033[00m\] "

if [[ -n $TMUX ]];
then
	PS1_SET_TITLE='$(settitle $PWD)';
	printf '\033Ptmux;\033\033]12;green\007\033\\'
fi

export PS1="$PS1_SET_TITLE $PS1_TIME $PS1_HOST $PS1_PWD $PS1_GIT $PS1_PROMPT"
#export PS1="\n\[\033[1;38;5;112m\]\D{%I:%M:%S %p}\[\033[00m\]\n"
#export PS1="\n\[\033[1;38;5;112m\]\D{%I:%M:%S %p}\[\033[00m\] \[\033[38;5;39m\]\u@$HOST \[\033[1;38;5;39m\]\w\[\033[00m\] \[\033[38;5;39m\]"'$(parse_git_branch)'"\[\033[00m\]\n\[\033[38;5;208m\]Â»\[\033[00m\] "

export SDIRS=~/conf/.sdirs
if [ -f ~/conf/inc/bashmarks/bashmarks.sh ]; then
	. ~/conf/inc/bashmarks/bashmarks.sh
fi

export GOROOT=$HOME/go
export GOARCH=amd64
export GOOS=linux
export PATH="/usr/local/bin:/usr/bin:/bin:/sbin:$GOROOT/bin"

# set HTTP_PROXY=localhost:8118
# set HTTPS_PROXY=localhost:8118

case "$SSH_TTY" in
/dev/pts*)
	;;
*)
	setterm -blank 0;
	;;
esac

if [ -f /etc/bash_completion ] && ! shopt -oq posix; then
    . /etc/bash_completion
fi

export HISTTIMEFORMAT="%F %T "
export HISTFILESIZE=900000000
export HISTSIZE=1000000
shopt -s histappend
PROMPT_COMMAND="history -a;$PROMPT_COMMAND"

# eval `resize`

shopt -s checkwinsize

# man color
#export LESS_TERMCAP_mb=$'\E[01;31m'
export LESS_TERMCAP_md=$'\E[1;38;5;222m'
export LESS_TERMCAP_me=$'\E[0m'
export LESS_TERMCAP_se=$'\E[0m'
export LESS_TERMCAP_so=$'\E[30;48;5;32m'
export LESS_TERMCAP_ue=$'\E[0m'
export LESS_TERMCAP_us=$'\E[38;5;117m'

if [ -f ~/.zhengkai_alias ]; then
    . ~/.zhengkai_alias
fi

